<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>เครื่องมือช่วยแต่งคำประพันธ์ประเภทฉันท์</title>
  <meta name="description" content="รวมเครื่องมือช่วยแต่งคำประพันธ์ไทยประเภทฉันท์">
  <link rel="icon" type="image/png" href="https://nonthaphathr.github.io/uploadimg/logokhampraphan-non.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <style>
        body { box-sizing: border-box; font-family: 'Prompt', sans-serif; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shine { 0% { background-position: -200% center; } 100% { background-position: 200% center; } }
        @keyframes textShimmer { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        .tool-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
        .tool-card:hover { transform: scale(1.05) translateY(-8px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
        .tool-card:hover .tool-image { filter: brightness(1.1); transform: scale(1.05); }
        .tool-image { transition: all 0.5s ease; }
        .quote-badge { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 4px 15px rgba(255, 165, 0, 0.1); animation: float 3s ease-in-out infinite; }
        .quote-text { background: linear-gradient(45deg, #ff6b6b, #ffb86c, #ff6b6b); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: textShimmer 3s linear infinite; }
        .visitor-badge { animation: fadeIn 1.5s ease-out 0.5s forwards; opacity: 0; }
        .loading-spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid white; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }

        /* Modal & Star Rating */
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
        .star-icon { cursor: pointer; transition: transform 0.2s, color 0.2s; }
        .star-icon:hover { transform: scale(1.2); }
        .star-active { color: #FFD700; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
        .star-inactive { color: #CBD5E1; }
        .floating-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 40;
            background: linear-gradient(135deg, #ff8a00, #e52e71);
            color: white; border-radius: 50px; padding: 12px 24px;
            box-shadow: 0 10px 25px rgba(229, 46, 113, 0.4);
            transition: all 0.3s ease; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
        }
        .floating-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(229, 46, 113, 0.6); }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full">
  <div id="loading" class="fixed inset-0 bg-gradient-to-br from-yellow-50 via-orange-50 to-pink-50 flex items-center justify-center z-50">
   <div class="text-center">
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-gray-600 text-lg">กำลังโหลด...</p>
   </div>
  </div>
  
  <div id="main-content" class="min-h-full bg-gradient-to-br from-yellow-50 via-orange-50 to-pink-50 py-8 px-4" style="opacity: 0;">
   <div class="max-w-6xl mx-auto">
    
    <header class="text-center mb-10 animate-fade-in-up" style="animation-delay: 0.1s; opacity: 0;">
     <div class="mb-6 inline-block rounded-full shadow-lg overflow-hidden hover:scale-105 transition-transform duration-300">
         <img id="logo" src="https://nonthaphathr.github.io/uploadimg/logokhampraphan-non.png" alt="Logo" class="w-32 h-32 md:w-40 md:h-40 object-cover" onerror="this.src=''; this.style.display='none';">
     </div>
     <h1 id="main-title" class="text-3xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-yellow-600 via-orange-500 to-pink-500 bg-clip-text text-transparent drop-shadow-sm">เครื่องมือช่วยแต่งคำประพันธ์ประเภทฉันท์</h1>
     <div id="subtitle" class="text-base md:text-lg text-gray-700 max-w-4xl mx-auto px-4 leading-relaxed">
        <span class="font-semibold text-gray-800">พัฒนาโดย ครูนนทพัทธ์ หิรัญเรือง</span><br>
        <span class="text-gray-600">กลุ่มสาระการเรียนรู้ภาษาไทย โรงเรียนกระดุมทองวิทยา สังกัดองค์การบริหารส่วนจังหวัดศรีสะเกษ</span>
     </div>
     <div class="mt-8 animate-fade-in-up" style="animation-delay: 0.2s; opacity: 0;">
        <div class="quote-badge inline-block px-6 py-3 rounded-full">
            <span class="text-lg md:text-xl font-bold quote-text">✨ เพื่อนคิดครูภาษาไทย พัฒนาศิษย์ก้าวไกล ด้วยเทคโนโลยี ✨</span>
        </div>
     </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-12 max-w-4xl mx-auto">
     <a href="https://nonthaphathr.github.io/manavokkachunt8/" target="_blank" class="tool-card bg-white rounded-2xl shadow-lg p-6 animate-fade-in-up" style="animation-delay: 0.3s; opacity: 0;">
      <div class="aspect-square mb-4 overflow-hidden rounded-xl"><img src="https://nonthaphathr.github.io/uploadimg/chunt1.png" class="tool-image w-full h-full object-cover"></div>
      <h3 class="text-lg md:text-xl font-semibold text-center text-gray-800">เครื่องมือแต่งมาณวกฉันท์ 8</h3>
     </a>
     <a href="https://nonthaphathr.github.io/intharavichian11/" target="_blank" class="tool-card bg-white rounded-2xl shadow-lg p-6 animate-fade-in-up" style="animation-delay: 0.4s; opacity: 0;">
      <div class="aspect-square mb-4 overflow-hidden rounded-xl"><img src="https://nonthaphathr.github.io/uploadimg/chunt2.png" class="tool-image w-full h-full object-cover"></div>
      <h3 class="text-lg md:text-xl font-semibold text-center text-gray-800">เครื่องมือแต่งอินทรวิเชียรฉันท์ 11</h3>
     </a>
     <a href="https://nonthaphathr.github.io/phuchongkapayatachunt12/" target="_blank" class="tool-card bg-white rounded-2xl shadow-lg p-6 animate-fade-in-up" style="animation-delay: 0.5s; opacity: 0;">
      <div class="aspect-square mb-4 overflow-hidden rounded-xl"><img src="https://nonthaphathr.github.io/uploadimg/chunt3.png" class="tool-image w-full h-full object-cover"></div>
      <h3 class="text-lg md:text-xl font-semibold text-center text-gray-800">เครื่องมือแต่งภุชงคปยาตฉันท์ 12</h3>
     </a>
     <a href="https://nonthaphathr.github.io/wasantadilokchunt14/" target="_blank" class="tool-card bg-white rounded-2xl shadow-lg p-6 animate-fade-in-up" style="animation-delay: 0.6s; opacity: 0;">
      <div class="aspect-square mb-4 overflow-hidden rounded-xl"><img src="https://nonthaphathr.github.io/uploadimg/chunt4.png" class="tool-image w-full h-full object-cover"></div>
      <h3 class="text-lg md:text-xl font-semibold text-center text-gray-800">เครื่องมือแต่งวสันตดิลกฉันท์ 14</h3>
     </a>
    </div>

    <footer class="text-center mt-12 pb-24 animate-fade-in-up" style="animation-delay: 0.7s; opacity: 0;">
     <div class="visitor-badge inline-block bg-white rounded-full px-6 py-3 shadow-lg mb-4 border border-orange-100">
      <div class="flex items-center gap-3">
       <svg class="w-5 h-5 text-orange-500" fill="currentColor" viewbox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" /></svg>
       <span class="text-gray-700 font-semibold">ผู้เข้าชม: <span id="visitor-count" class="text-orange-600">กำลังโหลด...</span></span>
      </div>
     </div>
     <p id="footer-text" class="text-gray-600 text-sm">© 2024 สงวนลิขสิทธิ์ ครูนนทพัทธ์ หิรัญเรือง</p>
    </footer>
   </div>

   <button onclick="openModal()" class="floating-btn group">
       <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
       </svg>
       <span class="font-semibold">เสนอแนะ</span>
   </button>

   <div id="feedbackModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
       <div class="modal-backdrop absolute inset-0" onclick="closeModal()"></div>
       <div class="absolute inset-0 flex items-center justify-center p-4 min-h-screen">
           <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-100 p-6 animate-fade-in-up relative">
               
               <div class="text-center mb-6">
                   <h3 class="text-2xl font-bold text-gray-800 mb-2">ความพึงพอใจ</h3>
                   <p class="text-gray-500 text-sm">โปรดให้คะแนนและข้อเสนอแนะเพื่อการพัฒนา</p>
               </div>

               <div class="flex justify-center gap-2 mb-6">
                   <svg onclick="rate(1)" class="w-10 h-10 star-icon star-inactive" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                   <svg onclick="rate(2)" class="w-10 h-10 star-icon star-inactive" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                   <svg onclick="rate(3)" class="w-10 h-10 star-icon star-inactive" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                   <svg onclick="rate(4)" class="w-10 h-10 star-icon star-inactive" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                   <svg onclick="rate(5)" class="w-10 h-10 star-icon star-inactive" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
               </div>

               <div class="mb-4">
                   <label class="block text-gray-700 text-sm font-bold mb-2" for="suggestion">
                       ข้อเสนอแนะ (สั้นๆ)
                   </label>
                   <textarea id="suggestion" rows="2" class="shadow-inner appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-orange-400 bg-gray-50" placeholder="เช่น อยากให้เพิ่มฉันท์..."></textarea>
               </div>

               <div class="mb-6">
                   <label class="block text-gray-700 text-sm font-bold mb-2" for="author">
                       ข้อมูลผู้ตอบ (ไม่บังคับ)
                   </label>
                   <input type="text" id="author" class="shadow-inner appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-orange-400 bg-gray-50" placeholder="ชื่อ หรือ ช่องทางติดต่อ (ถ้ามี)">
               </div>

               <div class="flex gap-4 mb-4">
                   <button onclick="closeModal()" class="flex-1 py-2 px-4 rounded-xl border border-gray-300 text-gray-600 hover:bg-gray-100 transition">ปิด</button>
                   <button onclick="submitFeedback()" id="submitBtn" class="flex-1 py-2 px-4 rounded-xl bg-gradient-to-r from-orange-500 to-pink-500 text-white font-bold hover:shadow-lg transition transform active:scale-95">บันทึก</button>
               </div>

               <div class="text-center pt-4 border-t border-gray-100">
                    <p class="text-blue-900 font-semibold text-sm leading-relaxed">
                       ช่วยสนับสนุนค่ากาแฟครูนนทพัทธ์<br>
                       <span class="font-bold">ธนาคารกรุงไทย เลขที่บัญชี : 343-0-37750-1</span>
                    </p>
               </div>
           </div>
       </div>
   </div>
  </div>

  <script>
        // *** ใส่ URL ที่ได้จาก Google Apps Script ตรงนี้ ***
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrno1FOPX_pRd7ZjWM1mx3v5Z_OP8IKa19QR9Wgg7qmpyhmZe8NY-DlX9QF6NvafcX/exec"; 

        const defaultConfig = {
            main_title: "เครื่องมือช่วยแต่งคำประพันธ์ประเภทฉันท์",
            subtitle: "<span class='font-semibold text-gray-800'>พัฒนาโดย ครูนนทพัทธ์ หิรัญเรือง</span><br><span class='text-gray-600'>กลุ่มสาระการเรียนรู้ภาษาไทย โรงเรียนกระดุมทองวิทยา สังกัดองค์การบริหารส่วนจังหวัดศรีสะเกษ</span>",
            footer_text: "© 2024 สงวนลิขสิทธิ์ ครูนนทพัทธ์ หิรัญเรือง"
        };

        // ... (SDK Functions เดิม) ...
        async function onConfigChange(config) { /* ...โค้ดเดิม... */ }
        function mapToCapabilities(config) { return { recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined }; }
        function mapToEditPanelValues(config) { /* ...โค้ดเดิม... */ }

        // Visitor Counter
        async function updateVisitorCount() {
            try {
                const response = await fetch('https://api.counterapi.dev/v1/poetry-tools-nonthaphat/visits/up');
                if (!response.ok) throw new Error('Network response');
                const data = await response.json();
                document.getElementById('visitor-count').textContent = data.count.toLocaleString('th-TH');
            } catch (error) {
                console.error('Visitor Error:', error);
                document.getElementById('visitor-count').textContent = 'รอสักครู่...';
            }
        }

        // --- Feedback Logic ---
        let currentRating = 0;

        function openModal() {
            document.getElementById('feedbackModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('feedbackModal').classList.add('hidden');
            resetForm();
        }

        function rate(n) {
            currentRating = n;
            const stars = document.querySelectorAll('.star-icon');
            stars.forEach((star, index) => {
                if (index < n) {
                    star.classList.remove('star-inactive');
                    star.classList.add('star-active');
                } else {
                    star.classList.remove('star-active');
                    star.classList.add('star-inactive');
                }
            });
        }

        function resetForm() {
            currentRating = 0;
            document.getElementById('suggestion').value = '';
            document.getElementById('author').value = ''; // Clear author field
            rate(0);
            const btn = document.getElementById('submitBtn');
            btn.innerText = 'บันทึก';
            btn.disabled = false;
        }

        async function submitFeedback() {
            if (currentRating === 0) {
                alert('กรุณาให้คะแนนความพึงพอใจก่อนบันทึก');
                return;
            }

            if (GOOGLE_SCRIPT_URL === "YOUR_GOOGLE_SCRIPT_URL") {
                alert('กรุณาตั้งค่า Google Script URL ในโค้ดก่อนใช้งาน');
                return;
            }

            const comment = document.getElementById('suggestion').value;
            const author = document.getElementById('author').value; // Get author value
            const btn = document.getElementById('submitBtn');
            
            // Loading State
            btn.innerText = 'กำลังบันทึก...';
            btn.disabled = true;

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        rating: currentRating,
                        comment: comment,
                        author: author // Send author data
                    })
                });

                alert('บันทึกข้อมูลเรียบร้อยแล้ว ขอบคุณสำหรับคำแนะนำครับ!');
                closeModal();

            } catch (error) {
                console.error('Error:', error);
                alert('เกิดข้อผิดพลาดในการบันทึก โปรดลองใหม่อีกครั้ง');
                btn.innerText = 'บันทึก';
                btn.disabled = false;
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', async () => {
            if (window.elementSdk) window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues });
            await updateVisitorCount();
            
            // Init logic to support <br> in subtitle from start
            document.getElementById('subtitle').innerHTML = defaultConfig.subtitle;

            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.opacity = '1';
            }, 1000);
        });
    </script>
 </body>
</html>
